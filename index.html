<!doctype html>
<html>
<head>
  <script src='//cdn.jsdelivr.net/g/d3js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
</head>
<body>
  
<script id="pattern" type="text/yaml">
type: circle
item:
- img: "http://lorempixel.com/100/100"
  url: ''
- img: "http://lorempixel.com/100/100"
  url: ''
- img: "http://lorempixel.com/100/100"
  url: ''
</script>
    
<script>
;( function(){
//Make SVG
var width = 600,
    height = 400;
  
var cwidth = 100,
    cheight = 100,
    cr = 50;

var ncol = 8,
    nrow = 4;
  
data = jsyaml.load( d3.select('#pattern').text() );
  
svg = d3.select('body')
    .append('svg')
    .attr('height', height)
    .attr('width', width);
    // append rows

pattern = svg.append('defs') 
    .selectAll('.pattern')
    .data( data['item'] )
    .call( function(s){
       s.enter()
        .append('pattern')
        .attr('x',0).attr('y',0) 
        .attr('width',cwidth).attr('height',cheight)
        .attr('patternUnits','userSpaceOnUse')
        .each( function(d,i){
          var id = 'pattern-image-'+i;
          
          d3.select(this)
            .datum( function(d){
              d['id'] = '#'+id;
              return d;
            });
         
          d3.select(this)
            .attr( 'id', id );
            
        })
        .each( function(d,i){
            d3.select(this) 
              .append('image')
              .attr('x',0).attr('y',0) 
              .attr('width',cwidth).attr('height',cheight)
              .attr('xlink:href', d['img'])
              .attr('type', 'image/png')
        })
    }).data()


svg.selectAll('.row')
    .data( d3.range( nrow ) )
    .call( function(s){
       s.enter()
        .append('g')
        .classed('row',true)
        .each( function(r){
            d3.select(this)
              .selectAll('.cell')
              .data( d3.range( ncol ) )
              .call( function(s){
                 s.enter()
                  .append( data['type']) //in the yaml
                  .classed('cell',true)
                  .attr( 'cx', function(c){
                      return cwidth*(c-1)+cr + (cr*(r%2));
                  })
                  .attr( 'cy', function(c){
                      return cheight*(r-1)+cr;
                 })
                  .attr( 'r', function(c){
                      return cr
                 })
                  .attr( 'fill', function(c){
                    var id = pattern[ (r*ncol+c)%pattern.length ]['id'];
                    return "url("+id+")"
                  })
                  
              })

        })
      
    });
    
    
//Make defs -> patterns
// append ids to pattern data
//Make SVG Polygons
//Add Interactions to Polygons
//Add Transition to polygons
  

  d3.select( 'circle' )
    .on( 'mouseenter', function(){
      d3.select(this)
        .attr( 'fill-opacity',1)
    })
    .on( 'mouseleave', function(){
      d3.select(this)
        .transition( )
        .ease('cubic')
        .duration( 1000 )
        .attr( 'fill-opacity',.6)
    })
    .on( 'click', function(d,i){
       // go somewhere
    })
})();
  
</script>

</body>
</html>
